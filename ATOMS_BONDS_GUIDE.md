# AtomsとBondsデータの作成ガイド

## 概要

atomsとbondsは、化合物の構造式をSVGで表示するために必要なデータです。

- **atoms**: 各原子の位置（x, y座標）と元素種
- **bonds**: 原子間の結合情報（どの原子とどの原子が結合しているか、結合の種類）

## データ形式

### Atoms（原子データ）

各原子は以下の形式で記述します：

```json
[
  {"id":"C1","element":"C","x":200,"y":200},
  {"id":"H1","element":"H","x":110,"y":110}
]
```

- **id**: 原子の一意の識別子（例: "C1", "H1", "O1"）
- **element**: 元素記号（"C", "H", "O", "N", "Cl", "Br"など）
- **x**: X座標（0以上の数値）
- **y**: Y座標（0以上の数値）

### Bonds（結合データ）

各結合は以下の形式で記述します：

```json
[
  {"from":"C1","to":"H1","type":"single"},
  {"from":"C1","to":"C2","type":"double"}
]
```

- **from**: 結合元の原子ID
- **to**: 結合先の原子ID
- **type**: 結合の種類
  - `"single"`: 単結合
  - `"double"`: 二重結合
  - `"triple"`: 三重結合

## 作成方法

### 方法1: 既存データをコピー（推奨）

既存の化合物データ（`src/data/compounds.ts`）から、該当する化合物のatomsとbondsをコピーして使用できます。

1. `src/data/compounds.ts` を開く
2. 該当する化合物の `structure.atoms` と `structure.bonds` をコピー
3. スプレッドシートのatoms列とbonds列に、JSON形式で貼り付け

**例: メタンの場合**

Atoms列:
```json
[{"id":"C1","element":"C","x":200,"y":200},{"id":"H1","element":"H","x":110,"y":110},{"id":"H2","element":"H","x":290,"y":110},{"id":"H3","element":"H","x":110,"y":290},{"id":"H4","element":"H","x":290,"y":290}]
```

Bonds列:
```json
[{"from":"C1","to":"H1","type":"single"},{"from":"C1","to":"H2","type":"single"},{"from":"C1","to":"H3","type":"single"},{"from":"C1","to":"H4","type":"single"}]
```

### 方法2: 手動で作成

新しい化合物を追加する場合は、以下の手順で作成します：

#### ステップ1: 原子の配置を決める

1. 中心となる原子（通常は炭素）を中心に配置
2. 結合する原子を適切な角度で配置
   - 単結合: 約109.5度（四面体）、120度（平面）、180度（直線）
   - 二重結合: 120度（平面）
   - 三重結合: 180度（直線）

#### ステップ2: 座標を計算

- 中心を (200, 200) とする
- 結合距離を約140ピクセルとする
- 角度から座標を計算:
  - 0度（右）: (x + 140, y)
  - 90度（上）: (x, y - 140)
  - 180度（左）: (x - 140, y)
  - 270度（下）: (x, y + 140)
  - 45度: (x + 99, y - 99) ※ 140 * cos(45°) ≈ 99

#### ステップ3: 結合を定義

各原子間の結合を定義します。原子IDを参照して結合を記述します。

### 方法3: エクスポートスクリプトを使用

既存の化合物データを一括でエクスポートする場合：

```bash
node scripts/exportToSpreadsheet.js > compounds_with_structure.csv
```

このコマンドで、既存の化合物データがCSV形式で出力されます。

## 座標の目安

### 基本的な配置パターン

#### 四面体配置（単結合、炭素）
```
     H2
      |
      |
H1 -- C -- H3
      |
      |
     H4
```
座標例:
- C: (200, 200)
- H1: (110, 110) - 左上
- H2: (290, 110) - 右上
- H3: (110, 290) - 左下
- H4: (290, 290) - 右下

#### 平面配置（二重結合、120度）
```
H1
 \
  C = C
 /     \
H2      H3
```
座標例:
- C1: (130, 200)
- C2: (270, 200)
- H1: (84, 110)
- H2: (84, 290)
- H3: (316, 110)
- H4: (316, 290)

#### ベンゼン環（六角形）
```
    H1
    |
    C1
   / \
  C6  C2
  |   |
  C5  C3
   \ /
    C4
    |
    H4
```
座標例（中心を200, 200として）:
- C1: (200, 80) - 上
- C2: (304, 140) - 右上
- C3: (304, 260) - 右下
- C4: (200, 320) - 下
- C5: (96, 260) - 左下
- C6: (96, 140) - 左上

## スプレッドシートへの入力方法

1. スプレッドシートの `compounds` シートを開く
2. 該当する行の `atoms` 列を選択
3. JSON形式のデータを貼り付け（ダブルクォートはそのまま）
4. 同様に `bonds` 列にもデータを貼り付け

**注意**: スプレッドシートでは、JSON内のダブルクォートが自動的にエスケープされる場合があります。その場合は、`""` が `"` として解釈されます。

## トラブルシューティング

### 構造式が表示されない

- JSON形式が正しいか確認（カンマ、角括弧、波括弧）
- 原子IDがbondsのfrom/toと一致しているか確認
- 座標が適切な範囲内か確認（負の値や極端に大きい値は避ける）

### 原子が重なって表示される

- 原子間の距離を確認（最低100ピクセル以上推奨）
- 座標を調整

### 結合が表示されない

- bondsのfrom/toがatomsのidと一致しているか確認
- typeが "single", "double", "triple" のいずれかか確認

## 参考: 既存の化合物データ

`src/data/compounds.ts` に以下の化合物の構造式データがあります：

1. メタン (CH4)
2. エタン (C2H6)
3. エチレン (C2H4)
4. アセチレン (C2H2)
5. ベンゼン (C6H6)
6. メタノール (CH3OH)
7. エタノール (C2H5OH)
8. ホルムアルデヒド (HCHO)

これらを参考にして、新しい化合物のデータを作成してください。

